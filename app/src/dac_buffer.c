/***************************************************************************//**
 * @file dac_buffer.c
 * @brief Implementation of DAC LUT driver.
 * @author Istvan Csomortani (istvan.csomortani@analog.com)
 ********************************************************************************
 * Copyright 2014-2016(c) Analog Devices, Inc.
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * - Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 * - Redistributions in binary form must reproduce the above copyright
 * notice, this list of conditions and the following disclaimer in
 * the documentation and/or other materials provided with the
 * distribution.
 * - Neither the name of Analog Devices, Inc. nor the names of its
 * contributors may be used to endorse or promote products derived
 * from this software without specific prior written permission.
 * - The use of this software may or may not infringe the patent rights
 * of one or more patent holders. This license does not release you
 * from the requirement that you obtain separate licenses from these
 * patent holders to use this software.
 * - Use of the software either in source or binary form, must be run
 * on or directly connected to an Analog Devices Inc. component.
 *
 * THIS SOFTWARE IS PROVIDED BY ANALOG DEVICES "AS IS" AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, NON-INFRINGEMENT,
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL ANALOG DEVICES BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, INTELLECTUAL PROPERTY RIGHTS, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *******************************************************************************/
#include "dac_buffer.h"

/******************************************************************************/
/******************************* Constant definitions *************************/
/******************************************************************************/

/* Signal Look Up Table */
//chirp 200 ns
//static const uint16_t signal_lut[1024] = {0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,3,4,5,5,4,2,65535,65530,65524,65516,65508,65501,65495,65493,65496,65506,65524,14,50,94,143,192,236,267,277,257,201,103,65498,65313,65094,64854,64614,64398,64237,64161,64201,64384,64728,65239,370,1169,2054,2963,3817,4528,5004,5157,4911,4213,3040,1407,64906,62562,60051,57545,55238,53336,52036,51512,51897,53272,55646,58958,63069,2235,7262,12298,17011,21063,24148,26003,26441,25358,22751,18715,13444,7216,377,58856,51987,45709,40386,36323,33746,32788,33483,35763,39472,44372,50163,56507,63048,3898,9808,14963,19143,22199,24051,24694,24189,22653,20249,17172,13636,9856,6039,2372,64551,61623,59215,57375,56116,55421,55246,55526,56182,57129,58278,59546,60854,62137,63340,64422,65354,584,1182,1615,1895,2039,2067,2002,1866,1681,1464,1234,1004,783,581,403,250,124,25,65487,65433,65399,65379,65373,65375,65385,65399,65415,65432,65450,65466,65481,65494,65505,65514,65522,65528,65532,65535,1,2,3,3,3,3,3,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

//chirp 500 ns
static const uint16_t signal_lut[1024] =  {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,65535,65535,0,0,0,1,1,2,3,3,3,3,2,1,0,65535,65533,65531,65530,65529,65528,65528,65529,65531,65534,1,5,9,13,17,19,19,18,15,9,2,65531,65521,65512,65503,65497,65493,65492,65496,65504,65516,65532,14,35,55,73,87,95,95,87,70,43,10,65507,65465,65423,65385,65356,65339,65336,65351,65384,65434,65500,41,125,210,287,349,390,403,384,330,242,123,65516,65357,65194,65039,64907,64811,64763,64772,64843,64978,65173,65418,163,462,757,1025,1240,1382,1431,1374,1206,928,550,93,65121,64592,64084,63635,63286,63072,63021,63151,63469,63969,64628,65413,739,1624,2469,3209,3782,4134,4221,4016,3510,2718,1671,425,64589,63175,61816,60611,59653,59026,58796,59006,59672,60779,62282,64105,611,2749,4847,6763,8360,9512,10117,10105,9439,8127,6216,3797,997,63512,60449,57538,54971,52925,51557,50984,51279,52466,54512,57328,60777,64674,3265,7381,11236,14588,17214,18930,19600,19144,17551,14873,11232,6808,1834,62119,56884,51969,47665,44238,41905,40830,41106,42750,45705,49834,54933,60742,1414,7691,13690,19078,23551,26849,28775,29204,28091,25476,21479,16296,10188,3469,62022,55139,48716,43091,38559,35362,33670,33575,35087,38132,42559,48144,54606,61619,3297,10352,16899,22615,27225,30508,32312,32562,31256,28474,24362,19134,13050,6413,65080,58307,51948,46294,41599,38066,35838,34994,35546,37440,40562,44742,49767,55390,61342,1811,7601,12922,17550,21299,24030,25651,26127,25472,23749,21070,17582,13461,8909,4133,64884,60290,56076,52403,49406,47181,45791,45257,45565,46666,48480,50900,53799,57038,60469,63943,1784,4933,7739,10108,11969,13274,14003,14158,13763,12866,11529,9830,7855,5695,3446,1198,64573,62576,60807,59319,58150,57323,56846,56715,56910,57403,58155,59120,60249,61488,62784,64087,65349,991,2051,2962,3703,4262,4632,4816,4821,4661,4356,3928,3401,2802,2158,1494,836,204,65156,64633,64184,63818,63540,63351,63249,63231,63288,63412,63593,63819,64079,64361,64653,64945,65228,65494,197,409,586,728,833,902,937,939,912,861,789,700,600,493,382,272,166,66,65513,65433,65365,65310,65267,65238,65220,65214,65217,65230,65250,65275,65305,65338,65373,65408,65443,65476,65506,65534,21,42,59,72,81,87,90,90,87,83,76,69,61,52,42,33,25,16,9,2,65533,65528,65524,65521,65519,65517,65516,65516,65517,65517,65519,65520,65522,65524,65526,65528,65529,65531,65533,65534,0,0,1,1,2,2,3,3,3,3,3,3,2,2,2,2,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};

//chirp 1 us
//static const uint16_t signal_lut[1024] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,65535,65535,65535,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,65535,65535,65534,65534,65534,65534,65534,65535,0,0,1,2,3,3,4,4,3,2,1,0,65535,65533,65532,65531,65530,65530,65530,65531,65533,65535,1,3,5,7,9,10,10,8,6,4,0,65533,65530,65526,65523,65522,65521,65522,65524,65527,65532,0,6,11,16,20,23,23,21,18,12,5,65534,65525,65517,65510,65504,65501,65501,65504,65510,65519,65530,6,18,30,41,48,52,51,46,37,24,7,65526,65507,65490,65475,65465,65459,65460,65468,65482,65501,65525,14,42,67,89,104,112,111,101,81,53,19,65518,65479,65442,65410,65387,65374,65374,65387,65414,65452,65499,16,72,126,173,208,229,233,219,185,135,70,65533,65454,65377,65308,65252,65217,65204,65217,65256,65320,65405,65506,78,187,288,373,434,464,459,418,343,236,104,65494,65341,65195,65066,64967,64906,64889,64922,65004,65131,65296,65489,159,366,556,715,828,884,877,803,665,469,228,65493,65210,64937,64694,64501,64374,64328,64368,64497,64710,64995,65334,168,546,903,1211,1447,1588,1621,1537,1338,1031,635,174,65215,64717,64255,63863,63573,63409,63390,63523,63806,64225,64757,65369,484,1131,1728,2230,2597,2799,2812,2630,2255,1706,1014,221,64916,64080,63309,62659,62181,61913,61884,62105,62570,63258,64131,65135,671,1741,2737,3586,4227,4607,4691,4462,3924,3100,2037,796,64991,63634,62353,61235,60361,59798,59595,59777,60345,61277,62523,64012,118,1811,3446,4913,6112,6954,7374,7330,6810,5831,4443,2722,768,64238,62185,60280,58648,57404,56638,56413,56760,57675,59116,61008,63244,155,2669,5091,7267,9053,10326,10993,10995,10314,8973,7038,4612,1833,64401,61419,58607,56144,54189,52875,52298,52513,53525,55294,57729,60699,64038,2014,5494,8731,11523,13693,15097,15633,15250,13951,11791,8883,5381,1481,62942,58928,55213,52023,49555,47969,47376,47829,49323,51790,55105,59093,63533,2641,7225,11483,15164,18046,19950,20749,20379,18842,16206,12602,8221,3298,63641,58464,53599,49322,45885,43491,42291,42369,43739,46342,50049,54671,59962,102,5855,11367,16333,20471,23546,25375,25843,24911,22612,19057,14425,8957,2940,62230,56089,50385,45429,41496,38804,37510,37694,39360,42432,46757,52116,58234,64792,5911,12315,18129,23042,26792,29175,30059,29387,27186,23563,18696,12833,6271,64881,57946,51359,45459,40551,36891,34668,34002,34930,37412,41324,46472,52600,59401,995,8101,14823,20825,25807,29519,31775,32462,31545,29071,25161,20010,13870,7046,65410,58240,51423,45292,40145,36230,33736,32778,33400,35568,39172,44035,49918,56535,63568,5140,11988,18248,23625,27870,30785,32241,32177,30603,27603,23326,17980,11822,5145,63801,57037,50704,45092,40454,36998,34874,34169,34902,37028,40438,44964,50389,56459,62891,3853,10124,15886,20884,24902,27770,29371,29648,28603,26300,22854,18433,13245,7529,1544,61096,55372,50160,45679,42118,39619,38275,38130,39172,41338,44519,48562,53278,58455,63863,3729,8896,13609,17675,20932,23254,24559,24809,24012,22219,19525,16058,11978,7467,2722,63482,58872,54619,50892,47834,45560,44147,43636,44029,45293,47357,50120,53455,57213,61233,65346,3847,7647,11062,13963,16245,17831,18673,18755,18092,16727,14732,12201,9247,5997,2587,64692,61373,58295,55572,53301,51559,50400,49853,49924,50594,51820,53541,55676,58132,60807,63591,838,3517,5992,8173,9988,11378,12304,12743,12694,12173,11215,9867,8192,6262,4158,1962,65296,63167,61188,59427,57943,56781,55972,55535,55474,55778,56424,57378,58594,60020,61598,63265,64959,1080,2646,4066,5294,6295,7040,7513,7706,7622,7275,6687,5886,4910,3797,2593,1342,90,64417,63289,62279,61418,60729,60229,59928,59829,59926,60209,60661,61260,61979,62790,63661,64560,65457,784,1588,2307,2921,3415,3776,3998,4080,4026,3842,3541,3137,2648,2094,1496,875,252,65184,64617,64103,63658,63291,63012,62826,62733,62733,62822,62991,63234,63537,63890,64277,64687,65104,65515,371,734,1058,1334,1556,1720,1823,1866,1850,1779,1657,1491,1288,1055,803,538,271,8,65296,65066,64861,64687,64547,64443,64376,64347,64355,64396,64469,64569,64692,64834,64988,65150,65315,65477,95,240,370,482,574,646,694,721,726,710,675,622,556,477,389,296,199,103,9,65457,65375,65302,65240,65190,65152,65127,65114,65114,65125,65146,65177,65216,65261,65311,65364,65418,65472,65525,38,83,124,159,188,210,225,233,235,230,220,205,185,162,136,108,79,50,21,65531,65506,65483,65463,65446,65432,65422,65416,65413,65413,65416,65422,65431,65441,65454,65467,65481,65496,65511,65525,2,14,26,36,44,51,56,60,61,61,60,57,53,48,43,36,29,22,15,8,2,65533,65527,65522,65518,65514,65511,65509,65508,65507,65508,65508,65510,65512,65514,65517,65520,65523,65526,65529,65532,65535,1,4,6,8,9,11,11,12,12,12,12,11,11,10,9,7,6,5,3,2,1,0,0,65535,65534,65533,65532,65532,65532,65531,65531,65531,65531,65532,65532,65532,65533,65533,65534,65534,65535,65535,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 };

/******************************************************************************/
/************************ Functions Definitions *******************************/
/******************************************************************************/

uint32_t dac_buffer_load(dac_core core, uint32_t start_address) {

	uint32_t no_of_samples;
	uint32_t index_i;
	uint32_t index_mem = 0;

	no_of_samples = sizeof(signal_lut) / sizeof(typeof(signal_lut[0]));

	for (index_i = 0; index_i < no_of_samples; index_i++) {
		ad_reg_write_16(start_address + (index_mem + 0) * 2, signal_lut[index_i]);
		ad_reg_write_16(start_address + (index_mem + 1) * 2, signal_lut[index_i]);
		index_mem += 2;
	}

	ad_dcache_flush();

	return (core.no_of_channels * no_of_samples);
}



